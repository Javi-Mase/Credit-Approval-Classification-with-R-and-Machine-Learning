setwd("/home/manu/FIUM/TERCERO/PrimerCuatri/AC/Proyecto/PracticasAC")
if(!require("caret")) {
install.packages("caret", dependencies = c("Depends", "Suggests"))
require(caret)
}
credit_sin_na <- na.omit(credit) # Crea una copia sin filas con NA
if(!require("caret")) {
install.packages("caret", dependencies = c("Depends", "Suggests"))
require(caret)
}
# Descargamos la base de datos
url <- "https://archive.ics.uci.edu/static/public/27/credit+approval.zip"
download.file(url, destfile = "credit_approval.zip")
# Descomprimimos la base de datos
unzip("credit_approval.zip")
# Cargamos la base de datos, na.string = "?" quitamos los datos con ese valor y lo sustituye por NA
credit <- read.table("crx.data", header = FALSE, sep = ",", na.strings = "?")
# Cargamos en credit.trainIdx la base de datos descargada del UCI
credit.trainIdx <- readRDS("credit.trainIdx.rds")
credit.Datos.Train <- credit[credit.trainIdx,]
credit.Datos.Test <- credit[-credit.trainIdx,]
# Estos comandos es para comprobar que tiene 553 observaciones
nrow(credit.Datos.Train)
nrow(credit.Datos.Test)
# Muestra la cantidad de valores NA por columna
# Esto es por si alguna columna tiene demasiados valores NA para eliminarla
colSums(is.na(credit))
# Visualizamos la tabla
str(credit)
# Convertir automáticamente columnas de tipo 'chr' a 'factor'
credit[sapply(credit, is.character)] <- lapply(credit[sapply(credit, is.character)], as.factor)
# Visualizamos los niveles
levels(credit$V1)
# Eliminamos niveles no usados
credit$V1 <- droplevels(credit$V1)
# Comprobamos
levels(credit$V1)
# El siguiente con erroes es V2
levels(credit$V2)
# V4
# Primero vamos a ver el interrogante
levels(credit$V4)
credit$V4 <- droplevels(credit$V4)
# Ahora vamos a añadir un elemento que no aparece y luego lo hacemos factor
levels(credit$V4)<-c(levels(credit$V4),"t")
str(credit$V4)
# V5 -> ?
levels(credit$V5)
credit$V5 <- droplevels(credit$V5)
# V6 -> ?
levels(credit$V6)
credit$V6 <- droplevels(credit$V6)
# V7
levels(credit$V7)
credit$V7 <- droplevels(credit$V7)
# V14
levels(credit$V14)
# Ahora vamos a renombrar algunas columnas para ganar legibilidad
levels(credit$V16) <- c("rechazada", "aprobada")
# Comprobamos que no hay missing-data:
sum(!complete.cases(credit))
# Ya hemos concluido este paso de arreglar los datos
summary(credit)
str(credit)
# Generamos un histograma base con la función hist() de R para la variable V2
# con probability = TRUE para mostrar la densidad en vez de las frecuencias absolutas.
hist(credit$V2, probability = TRUE, main = "Histograma de V2 con Curva de Densidad")
# Añadimos una línea de densidad para observar la forma de la distribución de V2,
# usando la función lines() y especificando el color "blue" para la curva.
lines(density(credit$V2, na.rm = TRUE), col = "blue")
# Creamos un histograma con ggplot2 para la variable V2 del dataframe 'credit',
# estableciendo aesthetic mapping (aes) para usar V2 en el eje x.
myHist = ggplot(data = credit, aes(credit$V2)) +
# Añadimos un histograma con color de contorno naranja y relleno naranja claro (alpha = 0.2)
# y definimos intervalos de 5 unidades usando el argumento breaks.
geom_histogram(col = "orange", fill = "orange", alpha = 0.2, breaks = seq(0, 80, by = 5)) +
# Agregamos un título al gráfico usando labs().
labs(title = "Histograma para la variable V2 con línea de densidad")
# Añadimos una línea vertical en el histograma de ggplot para marcar la media de V2
# usando geom_vline() y especificando la posición con xintercept = mean().
myHist = myHist + geom_vline(xintercept = mean(credit$V2, na.rm = TRUE), col = "blue")
# Añadimos una línea vertical en el histograma de ggplot para marcar la mediana de V2
# usando geom_vline() y especificando la posición con xintercept = median().
myHist = myHist + geom_vline(xintercept = median(credit$V2, na.rm = TRUE), col = "red")
# Mostramos el gráfico final en ggplot2 con el histograma de V2,
# junto con las líneas de media (azul) y mediana (roja).
myHist
# Cargamos la librería 'gridExtra' para facilitar la visualización si queremos combinar
# gráficos adicionales en una cuadrícula. (Aquí sólo la cargamos en caso de que queramos
# usar varios gráficos más adelante en el análisis).
library(gridExtra)
# Creamos el gráfico Q-Q para V2 utilizando ggplot2.
p1 = ggplot(data = credit, aes(sample = V2)) +
# Añadimos un título al gráfico Q-Q.
ggtitle("QQ plot para V2") +
# Añadimos los puntos del gráfico Q-Q, que compara los cuantiles de la muestra de V2
# con los cuantiles teóricos de una distribución normal.
geom_qq() +
# Añadimos la línea Q-Q teórica (stat_qq_line), que muestra cómo se deberían
# alinear los puntos si la distribución de V2 fuera normal.
stat_qq_line() +
# Etiquetas para los ejes: 'Distribución teórica' en el eje x y 'Distribución muestral' en el eje y.
xlab("Distribución teórica") +
ylab("Distribución muestral")
# Mostramos el gráfico Q-Q, que permite ver si los puntos se alinean (lo que indicaría normalidad)
# o si se desvían de la línea (indicando falta de normalidad en la distribución de V2).
p1
# Resumen estadístico de V16, que muestra la frecuencia de cada categoría en la variable.
summary(credit$V16)
# Verificamos la estructura de V16 para confirmar que es de tipo factor y ver
# las categorías presentes en la variable.
str(credit$V16)
# Calculamos el porcentaje de cada categoría en V16:
# Primero, usamos table(credit$V16) para obtener las frecuencias de cada categoría.
# Luego, aplicamos prop.table() para obtener la proporción relativa, multiplicando por 100 para obtener el porcentaje.
porcent <- prop.table(table(credit$V16)) * 100
# Creamos una tabla combinada que incluye tanto el número total (frecuencia) como el porcentaje de cada categoría:
# Usamos cbind() para unir el total (frecuencia) y el porcentaje en una tabla.
porcent_table <- cbind(total = table(credit$V16), porcentaje = porcent)
# Mostramos el vector de porcentajes, que nos permite ver el porcentaje de cada categoría.
porcent
# Creamos el gráfico de sectores con pie(), donde usamos el vector de porcentajes.
# El argumento main establece el título del gráfico y col usa la función rainbow() para aplicar un color diferente
# a cada sector, igual al número de categorías en V16.
pie(porcent, main = "Diagrama de Quesos para V16", col = rainbow(length(porcent)))
# Mostramos un resumen estadístico de V6, que nos indica la frecuencia de cada categoría en esta variable.
summary(credit$V6)
# Verificamos la estructura de V6 para confirmar que es una variable categórica (factor o carácter).
str(credit$V6)
# Calculamos el porcentaje de cada categoría en V6:
# Primero, obtenemos la frecuencia de cada categoría con table(credit$V6).
# Luego, usamos prop.table() para calcular la proporción relativa de cada categoría y multiplicamos por 100 para expresarlo en porcentaje.
porcent <- prop.table(table(credit$V6)) * 100
# Creamos una tabla que combina tanto el número total de observaciones (frecuencia) como el porcentaje de cada categoría:
# cbind() se usa para unir la frecuencia y el porcentaje en una tabla única.
porcent_table <- cbind(total = table(credit$V6), porcentaje = porcent)
# Mostramos el vector de porcentajes, lo que nos permite visualizar el porcentaje de cada categoría en V6.
porcent
# Creamos el gráfico de sectores (o "quesos") usando la función pie(), pasándole el vector de porcentajes.
# Establecemos un título con el argumento main y aplicamos diferentes colores a cada categoría usando rainbow().
pie(porcent, main = "Diagrama de Quesos para V6", col = rainbow(length(porcent)))
# Mostramos nuevamente el vector de porcentajes para recordar los valores antes de proceder con el análisis de los valores NA.
porcent
# Calculamos la suma del resumen de V6 para confirmar el número total de observaciones, incluyendo posibles NA.
sum(summary(credit$V6))
# Calculamos el porcentaje de valores NA en la variable V6, asumiendo que hay 9 valores NA de un total de 690 observaciones.
porcentaje_na <- 9 / 690 * 100
porcentaje_na
# Realizamos un resumen estadístico de la variable V15 para obtener una visión general de los valores,
# incluyendo mínimos, máximos, media y mediana.
summary(credit$V15)
# Generamos un histograma básico para observar la distribución de V15.
# Usamos probability = TRUE para mostrar el histograma en términos de densidad.
hist(credit$V15, probability = TRUE,
main = "Histograma de V15 con Curva de Densidad")
# Añadimos una curva de densidad a la gráfica para visualizar mejor la forma de la distribución,
# usando la función density() con na.rm = TRUE para excluir valores NA.
lines(density(credit$V15, na.rm = TRUE), col = "blue")
# Creamos un histograma de V15 con ggplot2, aplicando intervalos de 10 en el rango de 0 a 1000.
myHist = ggplot(data = credit, aes(credit$V15)) +
geom_histogram(col = "orange", fill = "orange", alpha = 0.2, breaks = seq(0, 1000, by = 10)) +
labs(title = "Histograma para la variable V15 con línea de densidad")
# Añadimos una línea vertical azul en el histograma para indicar la media de V15,
# utilizando mean() y especificando que se ignoren valores NA.
myHist = myHist + geom_vline(xintercept = mean(credit$V15, na.rm = TRUE), col = "blue")
# Añadimos una línea vertical roja para indicar la mediana de V15, usando median().
myHist = myHist + geom_vline(xintercept = median(credit$V15, na.rm = TRUE), col = "red")
# Mostramos el gráfico final en ggplot2, que incluye el histograma de V15 y las líneas de media y mediana.
myHist
library(gridExtra)
p1 = ggplot(data=credit,aes(sample=V15)) +
ggtitle("QQ plot para V15") +
geom_qq() +
stat_qq_line() +
xlab("Distribución teórica") + ylab("Distribución muestral")
p1
# Multivariable
summary(credit$V15)
library(reshape2)
# creando una estructura de datos para usar lattice con facilidad con "melt()"
library(reshape2)
melted_data <- melt(credit, id.vars = "V16", measure.vars = "V2",
variable.name = "Variable", value.name = "Value")
melted_data
library(ggplot2)
ggplot(melted_data, aes(x = V16, y = Value)) +
geom_boxplot() +
xlab("Categoría de V16") +
ylab("Valores de V2") +
ggtitle("Distribución de V2 por Categoría de V16")
library(ggplot2)
# Gráfico de densidad ajustado
ggplot(data = melted_data, aes(x = Value, color = V16, fill = V16)) +
geom_density(alpha = 0.6) +
scale_fill_discrete() +
scale_color_discrete() +
ylab("Densidad") +  # Etiqueta para el eje y
xlab("Valores") +   # Etiqueta para el eje x
ggtitle("Densidad de Valores por Especie")  # Título del gráfico
library(ggplot2)
ggplot(melted_data, aes(x = V16, y = Value, color=V16, fill=V16)) +
geom_boxplot(alpha=0.6) +
geom_jitter(color="black") +
scale_fill_discrete() +
scale_color_discrete() +
xlab("Categoría de V16") +
ylab("Valores de V2") +
ggtitle("Distribución de V2 por Categoría de V16")
melted_data <- melt(credit, id.vars = "V16", measure.vars = "V9",
variable.name = "Variable", value.name = "Value")
melted_data
library(ggplot2)
ggplot(melted_data, aes(x = V16, y = Value)) +
geom_boxplot() +
xlab("Categoría de V16") +
ylab("Valores de V2") +
ggtitle("Distribución de V2 por Categoría de V16")
library(ggplot2)
# Gráfico de densidad ajustado
ggplot(data = melted_data, aes(x = Value, color = V16, fill = V16)) +
geom_density(alpha = 0.6) +
scale_fill_discrete() +
scale_color_discrete() +
ylab("Densidad") +  # Etiqueta para el eje y
xlab("Valores") +   # Etiqueta para el eje x
ggtitle("Densidad de Valores por Especie")  # Título del gráfico
colnames(credit)[colnames(credit) == "V1"] <- "Genero"
colnames(credit)[colnames(credit) == "V2"] <- "Edad"
colnames(credit)[colnames(credit) == "V3"] <- "Deuda"
colnames(credit)[colnames(credit) == "V4"] <- "EstadoCivil"
colnames(credit)[colnames(credit) == "V8"] <- "AnyosContratado"
colnames(credit)[colnames(credit) == "V10"] <- "Empleado"
colnames(credit)[colnames(credit) == "V11"] <- "Solvencia"
colnames(credit)[colnames(credit) == "V13"] <- "composicionPoblacion"
View(credit)
credit_sin_na <- na.omit(credit) # Crea una copia sin filas con NA
View(credit_sin_na)
sum(credit_sin_na)
sum(credit_sin_na$Genero)
sum(!is.na((credit_sin_na$Genero))
)
nrow(credit_sin_na)
credit_sin_na <- na.omit(credit) # Crea una copia sin filas con NA
nrow(credit_sin_na)
credit_constante <- credit # Crea una copia del dataframe
credit_constante$V1[is.na(credit_constante$V1)] <- "unknown" # Rellena NA en V1 con "unknown"
credit_constante <- credit # Crea una copia del dataframe
credit_constante$V1[is.na(credit_constante$V1)] <- "unknown" # Rellena NA en V1 con "unknown"
credit_constante$V1[is.na(credit_constante$V1)] <- credit_constante <- credit # Crea una copia del dataframe
credit_constante <- na.omit(credit)
credit_constante$V1
credit_constante <- credit
credit_constante$V1[is.na(credit_constante$V1)] <- "unknown"
credit_constante <- credit
credit_constante$Genero[is.na(credit_constante$V1)] <- "unknown"
credit_constante <- credit
credit_constante$Genero[is.na(credit_constante$Genero)] <- "unknown"
credit_constante <- credit
credit_constante$Genero[is.na(credit_constante$Genero)] <- "unknown" # Rellena NA en V1 con "unknown"
# Crea una copia del dataframe
credit_constante <- credit
# Agrega "unknown" como un nivel de la columna Genero
levels(credit_constante$Genero) <- c(levels(credit_constante$Genero), "unknown")
# Rellena los NA en Genero con "unknown"
credit_constante$Genero[is.na(credit_constante$Genero)] <- "unknown"
# Rellenar con una constante
credit_constante <- credit
levels(credit_constante$Genero) <- c(levels(credit_constante$Genero), "unknown")
credit_constante$Genero[is.na(credit_constante$Genero)] <- "unknown"
nrow(credit_constante)
nrow(credit)
View(credit_constante)
nrows(credit_constante$Genero == "unknown")
nrow(credit_constante$Genero == "unknown")
sum(credit_constante$Genero == "unknown")
# Razonable?
sum(credit_constante$Genero == "unknown")
nrows(credit_constante$Genero)/sum(credit_constante$Genero == "unknown")*100
nrow(credit_constante$Genero)/sum(credit_constante$Genero == "unknown")*100
nrow(credit_constante$Genero)
nrow(credit_constante)/sum(credit_constante$Genero == "unknown")*100
nrow(credit)
# Razonable?
sum(credit_constante$Genero == "unknown")
nrow(credit_constante)/sum(credit_constante$Genero == "unknown")*100
nrow(credit_constante)
sum(credit_constante$Genero == "unknown")/nrow(credit_constante)*100
# Imputar con la media de la columna
credit_media <- credit # Crea una copia del dataframe
credit_media$Edad[is.na(credit_media$Edad)] <- mean(credit$Edad, na.rm = TRUE)
sum(is.na(credit_media$Edad))
# Imputar con la media de la columna
credit_media <- credit # Crea una copia del dataframe
sum(is.na(credit_media$Edad))
credit_media$Edad[is.na(credit_media$Edad)] <- mean(credit$Edad, na.rm = TRUE)
sum(is.na(credit_media$Edad))
# Histograma para ver la forma general de la distribución
hist(credit$V2, main = "Distribución de V2", xlab = "V2", col = "lightblue", breaks = 20)
hist(credit$Edad, main = "Distribución de V2", xlab = "Edad", col = "lightblue", breaks = 20)
boxplot(credit$Edad, main = "Boxplot de V2", horizontal = TRUE, col = "lightgreen")
boxplot(credit$Edad, main = "Boxplot de V2", col = "lightgreen")
boxplot(credit$V2, main = "Boxplot de V2", horizontal = TRUE, col = "lightgreen")summary
c
a
summary(credit)
# Por tanto deberíamos de usar la mediana:
credit_mediana <- credit # Crea una copia del dataframe
sum(is.na(credit_mediana$Edad))
credit_mediana$Edad[is.na(credit_mediana$Edad)] <- median(credit$Edad, na.rm = TRUE)
sum(is.na(credit_mediana$Edad))
credit_media <- credit # Crea una copia del dataframe
sum(is.na(credit_media$Edad))
credit_media$Edad[is.na(credit_media$Edad)] <- mean(credit$Edad, na.rm = TRUE)
sum(is.na(credit_media$Edad))
hist(credit$Edad, main = "Distribución de V2", xlab = "Edad", col = "lightblue", breaks = 20)
hist(credit$Edad, main = "Distribución de V2", xlab = "Edad", col = "lightblue", breaks = 20)
boxplot(credit$Edad, main = "Boxplot de V2", col = "lightgreen")
# Por tanto deberíamos de usar la mediana:
credit_mediana <- credit
sum(is.na(credit_mediana$Edad))
credit_mediana$Edad[is.na(credit_mediana$Edad)] <- median(credit$Edad, na.rm = TRUE)
sum(is.na(credit_mediana$Edad))
###################################################################
###################################################################
# He pensado que podemos hacer una criba en base al número de NA, voy
# a calcular todos por columnas por si acaso:
numero_na_por_columnas = credit.isna().sum()
###################################################################
###################################################################
# He pensado que podemos hacer una criba en base al número de NA, voy
# a calcular todos por columnas por si acaso:
numero_na_por_columnas <- credit.isna().sum()
###################################################################
###################################################################
# He pensado que podemos hacer una criba en base al número de NA, voy
# a calcular todos por columnas por si acaso:
numero_na_por_columnas <- credit.isna().sum()
###################################################################
###################################################################
# He pensado que podemos hacer una criba en base al número de NA, voy
# a calcular todos por columnas por si acaso:
numero_na_por_columnas <- credit.isna().sum()
###################################################################
###################################################################
# He pensado que podemos hacer una criba en base al número de NA, voy
# a calcular todos por columnas por si acaso:
numero_na_por_columnas <- credit.isna().sum()
###################################################################
###################################################################
# He pensado que podemos hacer una criba en base al número de NA, voy
# a calcular todos por columnas por si acaso:
numero_na_por_columnas <- colSums(is.na(credit))
numero_na_por_columnas
